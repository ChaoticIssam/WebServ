#include "GetMethod.hpp"

void Response::getMethod(std::map<int, Webserve>& multi_fd, int fd, Helpers* help) {
	convertExtention();
	(void)multi_fd;
	(void)help;
	int type = resourceType();
	std::cout << "type: " << type << std::endl;
	if (type == NOT_FOUND) {
		if (access(_URI.c_str(), F_OK) == 0){
			_statusCode = "403";
			_message = "Forbidden";
		}
			// throw ResponseException("403", "Forbidden - 1");
		else{
			_statusCode = "404";
			_message = "Not Found";
		}
			// throw ResponseException("404", "Not Found - 1");
	}
	if (type == DIREC) {
		if (_URI[_URI.size() - 1] != '/') {
			std::cout << "1???????????????????????????????????????????????????????????????????????????????????????" << std::endl;
			_URI += "/";
			_statusCode = "301";
			_message = "Moved Permanently";
			return;
		} else {
			std::cout << "2???????????????????????????????????????????????????????????????????????????????????????" << std::endl;
			findFiles(fd); //***
			_contentType = "text/html";
			return;
		}
	} else if (type == FILE) {
		std::string extension = getExtension();
		if (_extensions[extension].empty())
			_contentType = "text/plain";
		else
			_contentType = _extensions[extension];
		_statusCode = "200";
		_message = "OK";
	}
}